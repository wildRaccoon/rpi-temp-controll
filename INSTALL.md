# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é –Ω–∞ Raspberry Pi

–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—é —Å–∏—Å—Ç–µ–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ –Ω–∞ Raspberry Pi.

## üìã –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- Raspberry Pi –∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º Raspberry Pi OS
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- SSH –¥–æ—Å—Ç—É–ø –∞–±–æ –ø—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ Raspberry Pi

## üîß –ö—Ä–æ–∫ 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–∏

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏

```bash
sudo apt update
sudo apt upgrade -y
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

```bash
sudo apt install -y python3 python3-pip python3-venv git
```

## üì• –ö—Ä–æ–∫ 2: –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É

### –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Git)

```bash
cd ~
git clone <repository-url> tapo
cd tapo
```

–ê–±–æ —Å–∫–æ–ø—ñ—é–π—Ç–µ —Ñ–∞–π–ª–∏ –ø—Ä–æ–µ–∫—Ç—É –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é `~/tapo`

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

```bash
python3 -m venv venv
source venv/bin/activate
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

## üîå –ö—Ä–æ–∫ 3: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–∞—Ç—á–∏–∫—ñ–≤

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è DS18B20 (1-Wire —à–∏–Ω–∞)

1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤—Å—ñ 3 –¥–∞—Ç—á–∏–∫–∞ DS18B20 –¥–æ GPIO 4 (Pin 7):
   - VCC (—á–µ—Ä–≤–æ–Ω–∏–π) ‚Üí Pin 1 (3.3V)
   - DATA (–∂–æ–≤—Ç–∏–π/–±—ñ–ª–∏–π) ‚Üí Pin 7 (GPIO 4)
   - GND (—á–æ—Ä–Ω–∏–π) ‚Üí Pin 6 (GND)
   - –ü—ñ–¥—Ç—è–≥—É—é—á–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –º—ñ–∂ DATA —Ç–∞ VCC

2. –£–≤—ñ–º–∫–Ω—ñ—Ç—å 1-Wire —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
   ```bash
   sudo raspi-config
   # Interface Options ‚Üí 1-Wire ‚Üí Enable
   ```

3. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ:
   ```bash
   sudo reboot
   ```

4. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞—Ç—á–∏–∫–∏:
   ```bash
   ls /sys/bus/w1/devices/
   # –í–∏ –ø–æ–±–∞—á–∏—Ç–µ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç: 28-00000abc1234
   ```

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è MAX31855 (SPI)

1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å MAX31855 –¥–æ SPI:
   - VCC ‚Üí Pin 1 (3.3V)
   - GND ‚Üí Pin 6 (GND)
   - DIN ‚Üí Pin 19 (MOSI)
   - DO ‚Üí Pin 21 (MISO)
   - CLK ‚Üí Pin 23 (SCLK)
   - CS ‚Üí Pin 24 (GPIO 8) –∞–±–æ —ñ–Ω—à–∏–π GPIO

2. –£–≤—ñ–º–∫–Ω—ñ—Ç—å SPI:
   ```bash
   sudo raspi-config
   # Interface Options ‚Üí SPI ‚Üí Enable
   ```

3. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ:
   ```bash
   sudo reboot
   ```

4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ SPI:
   ```bash
   ls /dev/spi*
   # –ú–∞—î –±—É—Ç–∏ /dev/spidev0.0 –∞–±–æ /dev/spidev0.1
   ```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É

```bash
sudo usermod -a -G gpio,spi $USER
# –ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–π—Ç–∏ —Ç–∞ —É–≤—ñ–π—Ç–∏ –∑–Ω–æ–≤—É –∞–±–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
```

## ‚öôÔ∏è –ö—Ä–æ–∫ 4: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É

```bash
cp config.example.yaml config.yaml
nano config.yaml
```

### –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ID –¥–∞—Ç—á–∏–∫—ñ–≤ DS18B20

```bash
# –ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–∞—Ç—á–∏–∫—ñ–≤ —Ç–∞ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è 1-Wire
ls /sys/bus/w1/devices/

# –í–∏ –ø–æ–±–∞—á–∏—Ç–µ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:
# 28-011913a8f76d
# 28-011913a78132
# 28-011913c47b0c

# –°–∫–æ–ø—ñ—é–π—Ç–µ —Ü—ñ ID —Ç–∞ –≤–∫–∞–∂—ñ—Ç—å –≤ config.yaml –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è config.yaml

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `config.yaml`:

1. **–î–∞—Ç—á–∏–∫–∏ DS18B20:**
   ```yaml
   sensors:
     ds18b20:
       boiler:
         device_id: "28-xxxxx"  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
       accumulator_bottom:
         device_id: "28-yyyyy"  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
       accumulator_top:
         device_id: "28-zzzzz"  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
   ```

2. **–†–æ–∑–µ—Ç–∫–∞ Tapo:**
   ```yaml
   tapo:
     ip_address: "192.168.1.100"  # IP –∞–¥—Ä–µ—Å–∞ –≤–∞—à–æ—ó —Ä–æ–∑–µ—Ç–∫–∏
     email: "your_email@example.com"
     password: "your_password"
   ```

3. **–ü–æ—Ä–æ–≥–æ–≤—ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏:**
   ```yaml
   control:
     boiler_critical_temp: 85.0
     accumulator_critical_temp: 80.0
     boiler_safe_temp: 70.0
     accumulator_safe_temp: 65.0
     chimney_low_temp: 100.0
   ```

## üß™ –ö—Ä–æ–∫ 5: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø—É—Å–∫

```bash
cd ~/tapo
source venv/bin/activate
python main.py --test-mode --scenario normal
```

–í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://raspberry-pi-ip:8080/status.html`

### –¢–µ—Å—Ç –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞—Ç—á–∏–∫–∞–º–∏

```bash
python main.py
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
```bash
tail -f logs/temperature.log
```

## üöÄ –ö—Ä–æ–∫ 6: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —è–∫ systemd —Å–µ—Ä–≤—ñ—Å

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å —Ñ–∞–π–ª—É

```bash
cd ~/tapo
sudo cp tapo-temperature.service /etc/systemd/system/
```

### –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —à–ª—è—Ö—ñ–≤ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

–Ø–∫—â–æ –ø—Ä–æ–µ–∫—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–µ –≤ `/home/pi/tapo`, –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª:

```bash
sudo nano /etc/systemd/system/tapo-temperature.service
```

–ó–º—ñ–Ω—ñ—Ç—å —à–ª—è—Ö–∏:
- `WorkingDirectory` - —à–ª—è—Ö –¥–æ –ø—Ä–æ–µ–∫—Ç—É
- `ExecStart` - —à–ª—è—Ö –¥–æ Python —Ç–∞ main.py
- `User` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `pi`)

### –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ç–∞ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É

```bash
# –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ systemd
sudo systemctl daemon-reload

# –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable tapo-temperature.service

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å
sudo systemctl start tapo-temperature.service

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo systemctl status tapo-temperature.service
```

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–æ–º

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo systemctl status tapo-temperature.service

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
sudo journalctl -u tapo-temperature.service -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
sudo systemctl restart tapo-temperature.service

# –ó—É–ø–∏–Ω–∏—Ç–∏
sudo systemctl stop tapo-temperature.service

# –í–∏–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl disable tapo-temperature.service
```

## üîç –ö—Ä–æ–∫ 7: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ:
- `http://raspberry-pi-ip:8080/status.html` - –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
- `http://raspberry-pi-ip:8080/charts.html` - –≥—Ä–∞—Ñ—ñ–∫–∏

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ API

```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏
curl http://localhost:8080/api/status

# –î–∞—Ç—á–∏–∫–∏
curl http://localhost:8080/api/sensors

# –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏
curl http://localhost:8080/api/system
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

```bash
# –õ–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–∏
tail -f logs/temperature.log

# –õ–æ–≥–∏ systemd
sudo journalctl -u tapo-temperature.service -f
```

## üõ†Ô∏è –ö—Ä–æ–∫ 8: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è firewall (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø –∑ —ñ–Ω—à–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤:

```bash
sudo ufw allow 8080/tcp
```

## üìä –ö—Ä–æ–∫ 9: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
cd ~/tapo
source venv/bin/activate
sqlite3 data/temperature.db "SELECT COUNT(*) FROM temperature_readings;"
```

### –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
cp data/temperature.db data/temperature.db.backup.$(date +%Y%m%d)
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏

```bash
cd ~/tapo
source venv/bin/activate
git pull  # –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Git
pip install -r requirements.txt --upgrade
sudo systemctl restart tapo-temperature.service
```

## ‚ùó –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –î–∞—Ç—á–∏–∫–∏ –Ω–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
   ```bash
   ls /sys/bus/w1/devices/
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ 1-Wire:
   ```bash
   sudo raspi-config
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
   ```bash
   tail -f logs/temperature.log
   ```

### –†–æ–∑–µ—Ç–∫–∞ Tapo –Ω–µ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ IP –∞–¥—Ä–µ—Å—É —Ç–∞ –º–µ—Ä–µ–∂–µ–≤–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ email —Ç–∞ –ø–∞—Ä–æ–ª—å –≤ config.yaml
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —Ä–æ–∑–µ—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞:
   ```bash
   ping 192.168.1.100
   ```

### –°–µ—Ä–≤—ñ—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
   ```bash
   sudo journalctl -u tapo-temperature.service -n 50
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —à–ª—è—Ö–∏ –≤ —Å–µ—Ä–≤—ñ—Å —Ñ–∞–π–ª—ñ
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É:
   ```bash
   ls -la ~/tapo
   ```

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –¥–∏–≤—ñ—Ç—å—Å—è:
- [README.md](README.md) - –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
- [PLAN.md](PLAN.md) - –¥–µ—Ç–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç—É

