# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é –Ω–∞ Raspberry Pi

–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—é —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—é —Å–∏—Å—Ç–µ–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ –Ω–∞ Raspberry Pi.

## üìã –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- Raspberry Pi –∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º Raspberry Pi OS
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- SSH –¥–æ—Å—Ç—É–ø –∞–±–æ –ø—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ Raspberry Pi

## üîß –ö—Ä–æ–∫ 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–∏

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏

```bash
sudo apt update
sudo apt upgrade -y
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

```bash
sudo apt install -y python3 python3-pip python3-venv git
```

## üì• –ö—Ä–æ–∫ 2: –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É

### –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Git)

```bash
cd ~
git clone <repository-url> tapo
cd tapo
```

–ê–±–æ —Å–∫–æ–ø—ñ—é–π—Ç–µ —Ñ–∞–π–ª–∏ –ø—Ä–æ–µ–∫—Ç—É –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é `~/tapo`

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

```bash
python3 -m venv venv
source venv/bin/activate
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

## üîå –ö—Ä–æ–∫ 3: –ü—Ä–æ—à–∏–≤–∫–∞ Sonoff S60 –∑ Tasmota

### –í–∞—Ä—ñ–∞–Ω—Ç–∏ –ø—Ä–æ—à–∏–≤–∫–∏ Sonoff S60

–Ñ –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–µ—Ç–æ–¥–∏ –ø—Ä–æ—à–∏–≤–∫–∏ Tasmota –Ω–∞ Sonoff S60:

#### –ú–µ—Ç–æ–¥ 1: OTA –ø—Ä–æ—à–∏–≤–∫–∞ —á–µ—Ä–µ–∑ eWeLink (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤)

**–í–∞–∂–ª–∏–≤–æ:** –¶–µ–π –º–µ—Ç–æ–¥ –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞ –Ω–æ–≤—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö –ø—Ä–æ—à–∏–≤–∫–∏ Sonoff.

1. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ Sonoff S60 —á–µ—Ä–µ–∑ –¥–æ–¥–∞—Ç–æ–∫ eWeLink
2. –î—ñ–∑–Ω–∞–π—Ç–µ—Å—å IP –∞–¥—Ä–µ—Å—É —Ä–æ–∑–µ—Ç–∫–∏ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö —Ä–æ—É—Ç–µ—Ä–∞
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —É—Ç–∏–ª—ñ—Ç—É –¥–ª—è OTA –ø—Ä–æ—à–∏–≤–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, SonOTA)
4. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–æ—à–∏–≤–∫—É Tasmota –¥–ª—è ESP8266

#### –ú–µ—Ç–æ–¥ 2: –ü—Ä–æ—à–∏–≤–∫–∞ —á–µ—Ä–µ–∑ UART (–Ω–∞–¥—ñ–π–Ω–∏–π –º–µ—Ç–æ–¥)

**–ù–µ–æ–±—Ö—ñ–¥–Ω–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è:**
- USB to TTL –∞–¥–∞–ø—Ç–µ—Ä (3.3V!)
- –î—Ä–æ—Ç–∏ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- –ü–∞—è–ª—å–Ω–∏–∫ (–º–æ–∂–ª–∏–≤–æ)

**–ö—Ä–æ–∫–∏:**

1. **–†–æ–∑–±–µ—Ä—ñ—Ç—å Sonoff S60:**
   - –í—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ 220V
   - –í—ñ–¥–∫—Ä—É—Ç—ñ—Ç—å –≥–≤–∏–Ω—Ç–∏ —Ç–∞ –∑–Ω—ñ–º—ñ—Ç—å –∫—Ä–∏—à–∫—É
   - –ó–Ω–∞–π–¥—ñ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–∏ GPIO0, TX, RX, VCC, GND

2. **–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å USB to TTL –∞–¥–∞–ø—Ç–µ—Ä:**
   ```
   USB-TTL     ‚Üí  Sonoff S60
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   3.3V        ‚Üí  VCC (3.3V)
   GND         ‚Üí  GND
   TX          ‚Üí  RX
   RX          ‚Üí  TX
   ```
   **–í–ê–ñ–õ–ò–í–û:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ 3.3V! 5V –º–æ–∂–µ —Å–ø–∞–ª–∏—Ç–∏ ESP8266!

3. **–í–≤–µ–¥—ñ—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ—à–∏–≤–∫–∏:**
   - –ó–∞–º–∫–Ω—ñ—Ç—å GPIO0 –Ω–∞ GND
   - –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å USB –∞–¥–∞–ø—Ç–µ—Ä –¥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞
   - –ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –≤—ñ–¥–ø—É—Å—Ç–∏—Ç–∏ GPIO0

4. **–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Tasmota:**
   - –í—ñ–¥–∫—Ä–∏–π—Ç–µ [Tasmota Web Installer](https://tasmota.github.io/install/)
   - –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ esptool:
   ```bash
   pip install esptool
   esptool.py --port COM3 write_flash -fs 1MB -fm dout 0x0 tasmota.bin
   ```
   - –ó–∞–º—ñ–Ω—ñ—Ç—å COM3 –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç (Linux: /dev/ttyUSB0)

5. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Tasmota:**
   - –ü—ñ—Å–ª—è –ø—Ä–æ—à–∏–≤–∫–∏ Sonoff —Å—Ç–≤–æ—Ä–∏—Ç—å WiFi —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø—É "tasmota-XXXX"
   - –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –Ω–µ—ó
   - –ù–∞–ª–∞—à—Ç—É–π—Ç–µ WiFi –º–µ—Ä–µ–∂—É
   - –ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞ IP –∞–¥—Ä–µ—Å–æ—é

6. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—É –¥–ª—è Sonoff S60:**
   ```
   Configuration ‚Üí Configure Template

   –í–∏–±–µ—Ä—ñ—Ç—å "Sonoff S26" –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω–∏–π:
   - GPIO12: Relay1
   - GPIO13: LED1i (—ñ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–∏–π)
   - GPIO0: Button1
   ```

7. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:**
   - Configuration ‚Üí Configure Module ‚Üí Sonoff S26
   - Configuration ‚Üí Configure MQTT (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ Tasmota

```bash
# –í–∫–ª—é—á–∏—Ç–∏ —Ä–æ–∑–µ—Ç–∫—É
curl "http://192.168.1.100/cm?cmnd=Power%20On"

# –í–∏–º–∫–Ω—É—Ç–∏ —Ä–æ–∑–µ—Ç–∫—É
curl "http://192.168.1.100/cm?cmnd=Power%20Off"

# –°—Ç–∞—Ç—É—Å —Ä–æ–∑–µ—Ç–∫–∏
curl "http://192.168.1.100/cm?cmnd=Status"

# Toggle (–ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è)
curl "http://192.168.1.100/cm?cmnd=Power%20Toggle"
```

### –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ Tasmota

```bash
# –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
curl "http://192.168.1.100/cm?cmnd=Status%200"

# –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ñ–º'—è –ø—Ä–∏—Å—Ç—Ä–æ—é
curl "http://192.168.1.100/cm?cmnd=DeviceName%20Heater_Control"

# –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ MQTT (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
curl "http://192.168.1.100/cm?cmnd=MqttHost%20192.168.1.50"
curl "http://192.168.1.100/cm?cmnd=MqttPort%201883"
curl "http://192.168.1.100/cm?cmnd=Topic%20sonoff_s60"
```

## üå°Ô∏è –ö—Ä–æ–∫ 4: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–∞—Ç—á–∏–∫—ñ–≤

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è DS18B20 (1-Wire —à–∏–Ω–∞)

1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤—Å—ñ 3 –¥–∞—Ç—á–∏–∫–∞ DS18B20 –¥–æ GPIO 4 (Pin 7):
   - VCC (—á–µ—Ä–≤–æ–Ω–∏–π) ‚Üí Pin 1 (3.3V)
   - DATA (–∂–æ–≤—Ç–∏–π/–±—ñ–ª–∏–π) ‚Üí Pin 7 (GPIO 4)
   - GND (—á–æ—Ä–Ω–∏–π) ‚Üí Pin 6 (GND)
   - –ü—ñ–¥—Ç—è–≥—É—é—á–∏–π —Ä–µ–∑–∏—Å—Ç–æ—Ä 4.7 –∫–û–º –º—ñ–∂ DATA —Ç–∞ VCC

2. –£–≤—ñ–º–∫–Ω—ñ—Ç—å 1-Wire —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
   ```bash
   sudo raspi-config
   # Interface Options ‚Üí 1-Wire ‚Üí Enable
   ```

3. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ:
   ```bash
   sudo reboot
   ```

4. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞—Ç—á–∏–∫–∏:
   ```bash
   ls /sys/bus/w1/devices/
   # –í–∏ –ø–æ–±–∞—á–∏—Ç–µ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç: 28-00000abc1234
   ```

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è MAX31855 (SPI —Ç–µ—Ä–º–æ–ø–∞—Ä–∞ –¥–ª—è –¥–∏–º–∞—Ä—è)

1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å MAX31855 –¥–æ Raspberry Pi —á–µ—Ä–µ–∑ SPI:

   | MAX31855 | Raspberry Pi | GPIO | –ü—ñ–Ω |
   |----------|--------------|------|-----|
   | **VIN** | 3.3V | - | Pin 1 –∞–±–æ 17 |
   | **GND** | Ground | - | Pin 6, 9, 14, 20 (–±—É–¥—å-—è–∫–∏–π) |
   | **CLK** | SPI Clock | GPIO 11 | Pin 23 (SCLK) |
   | **CS** | Chip Select | GPIO 8 | Pin 24 (CE0) |
   | **DO** | SPI Data Out | GPIO 9 | Pin 21 (MISO) |

   **–í–∞–∂–ª–∏–≤–æ:**
   - MAX31855 –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∑ **3.3V** (–ù–ï 5V!)
   - DO (Data Out) –Ω–∞ –ø–ª–∞—Ç—ñ = MISO (Master In Slave Out) –Ω–∞ Raspberry Pi
   - MAX31855 –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î MOSI - —Ü–µ read-only –ø—Ä–∏—Å—Ç—Ä—ñ–π
   - –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å —Ç–µ—Ä–º–æ–ø–∞—Ä—É —Ç–∏–ø—É K –¥–æ –∫–ª–µ–º + —Ç–∞ - –Ω–∞ MAX31855

2. –£–≤—ñ–º–∫–Ω—ñ—Ç—å SPI —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
   ```bash
   sudo raspi-config
   # Interface Options ‚Üí SPI ‚Üí Enable ‚Üí Yes
   ```

3. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Raspberry Pi:
   ```bash
   sudo reboot
   ```

4. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ SPI –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ:
   ```bash
   ls /dev/spi*
   # –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏: /dev/spidev0.0 —Ç–∞ /dev/spidev0.1
   ```

5. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ SPI:
   ```bash
   source venv/bin/activate
   pip install spidev RPi.GPIO
   ```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É

```bash
sudo usermod -a -G gpio,spi $USER
# –ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–π—Ç–∏ —Ç–∞ —É–≤—ñ–π—Ç–∏ –∑–Ω–æ–≤—É –∞–±–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
```

## ‚öôÔ∏è –ö—Ä–æ–∫ 5: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É

```bash
cp config.example.yaml config.yaml
nano config.yaml
```

### –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è ID –¥–∞—Ç—á–∏–∫—ñ–≤ DS18B20

```bash
# –ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–∞—Ç—á–∏–∫—ñ–≤ —Ç–∞ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è 1-Wire
ls /sys/bus/w1/devices/

# –í–∏ –ø–æ–±–∞—á–∏—Ç–µ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:
# 28-011913a8f76d
# 28-011913a78132
# 28-011913c47b0c

# –°–∫–æ–ø—ñ—é–π—Ç–µ —Ü—ñ ID —Ç–∞ –≤–∫–∞–∂—ñ—Ç—å –≤ config.yaml –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è config.yaml

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `config.yaml`:

1. **–î–∞—Ç—á–∏–∫–∏ DS18B20:**
   ```yaml
   sensors:
     ds18b20:
       boiler:
         enabled: true
         device_id: "28-xxxxx"  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
         name: "–ö–æ—Ç–µ–ª"
       accumulator_bottom:
         enabled: true
         device_id: "28-yyyyy"  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
         name: "–¢–µ—Ä–º–æ–∞–∫—É–º—É–ª—è—Ç–æ—Ä (–Ω–∏–∑)"
       accumulator_top:
         enabled: true
         device_id: "28-zzzzz"  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID
         name: "–¢–µ—Ä–º–æ–∞–∫—É–º—É–ª—è—Ç–æ—Ä (–≤–µ—Ä—Ö)"
   ```

2. **–î–∞—Ç—á–∏–∫ MAX31855 (—Ç–µ—Ä–º–æ–ø–∞—Ä–∞ –¥–∏–º–∞—Ä—è):**
   ```yaml
   sensors:
     max31855:
       chimney:
         enabled: true
         cs_pin: 8              # GPIO 8 (Pin 24, CE0)
         spi_port: 0            # SPI0
         spi_device: 0          # SPI Device 0
         name: "–î–∏–º–∞—Ä"
   ```

   **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —ñ–Ω—à–∏–π CS –ø—ñ–Ω (–Ω–µ GPIO 8),
   –∑–º—ñ–Ω—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è `cs_pin` —Ç–∞ –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å CS –¥—Ä—ñ—Ç –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ GPIO.

3. **–†–æ–∑–µ—Ç–∫–∞ Sonoff S60 –∑ Tasmota:**
   ```yaml
   sonoff:
     ip_address: "192.168.1.100"  # IP –∞–¥—Ä–µ—Å–∞ —Ä–æ–∑–µ—Ç–∫–∏ Sonoff S60
     # Tasmota –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î HTTP API –∞–±–æ MQTT
     # –î–ª—è HTTP API –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç—ñ–ª—å–∫–∏ IP –∞–¥—Ä–µ—Å–∞
     # –î–ª—è MQTT –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –±—Ä–æ–∫–µ—Ä –Ω–∏–∂—á–µ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

   mqtt:  # –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ MQTT
     enabled: false
     broker: "192.168.1.50"
     port: 1883
     username: ""  # –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ
     password: ""  # –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ
     topic_prefix: "sonoff_s60"
   ```

4. **–ü–æ—Ä–æ–≥–æ–≤—ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏:**
   ```yaml
   control:
     boiler_critical_temp: 85.0
     accumulator_critical_temp: 80.0
     boiler_safe_temp: 70.0
     accumulator_safe_temp: 65.0
     chimney_low_temp: 100.0
   ```

## üß™ –ö—Ä–æ–∫ 6: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø—É—Å–∫

```bash
cd ~/tapo
source venv/bin/activate
python main.py --test-mode --scenario normal
```

–í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://raspberry-pi-ip:8080/status.html`

### –¢–µ—Å—Ç –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞—Ç—á–∏–∫–∞–º–∏

```bash
python main.py
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
```bash
tail -f logs/temperature.log
```

## üöÄ –ö—Ä–æ–∫ 7: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —è–∫ systemd —Å–µ—Ä–≤—ñ—Å

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å —Ñ–∞–π–ª—É

```bash
cd ~/tapo
sudo cp temperature.service /etc/systemd/system/
```

### –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —à–ª—è—Ö—ñ–≤ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

–Ø–∫—â–æ –ø—Ä–æ–µ–∫—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–µ –≤ `/home/pi/tapo`, –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª:

```bash
sudo nano /etc/systemd/system/temperature.service
```

–ó–º—ñ–Ω—ñ—Ç—å —à–ª—è—Ö–∏:
- `WorkingDirectory` - —à–ª—è—Ö –¥–æ –ø—Ä–æ–µ–∫—Ç—É
- `ExecStart` - —à–ª—è—Ö –¥–æ Python —Ç–∞ main.py
- `User` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `pi`)

### –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ç–∞ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É

```bash
# –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ systemd
sudo systemctl daemon-reload

# –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable temperature.service

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å
sudo systemctl start temperature.service

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo systemctl status temperature.service
```

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–æ–º

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo systemctl status temperature.service

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
   sudo journalctl -u temperature.service -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
sudo systemctl restart temperature.service

# –ó—É–ø–∏–Ω–∏—Ç–∏
sudo systemctl stop temperature.service

# –í–∏–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl disable temperature.service
```

## üîç –ö—Ä–æ–∫ 8: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ:
- `http://raspberry-pi-ip:8080/status.html` - –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
- `http://raspberry-pi-ip:8080/charts.html` - –≥—Ä–∞—Ñ—ñ–∫–∏

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ API

```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏
curl http://localhost:8080/api/status

# –î–∞—Ç—á–∏–∫–∏
curl http://localhost:8080/api/sensors

# –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏
curl http://localhost:8080/api/system
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

```bash
# –õ–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–∏
tail -f logs/temperature.log

# –õ–æ–≥–∏ systemd
sudo journalctl -u temperature.service -f
```

## üõ†Ô∏è –ö—Ä–æ–∫ 9: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è firewall (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø –∑ —ñ–Ω—à–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤:

```bash
sudo ufw allow 8080/tcp
```

## üìä –ö—Ä–æ–∫ 10: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
cd ~/tapo
source venv/bin/activate
sqlite3 data/temperature.db "SELECT COUNT(*) FROM temperature_readings;"
```

### –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
cp data/temperature.db data/temperature.db.backup.$(date +%Y%m%d)
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏

```bash
cd ~/tapo
source venv/bin/activate
git pull  # –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Git
pip install -r requirements.txt --upgrade
sudo systemctl restart temperature.service
```

## ‚ùó –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –î–∞—Ç—á–∏–∫–∏ –Ω–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
   ```bash
   ls /sys/bus/w1/devices/
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ 1-Wire:
   ```bash
   sudo raspi-config
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
   ```bash
   tail -f logs/temperature.log
   ```

### –†–æ–∑–µ—Ç–∫–∞ Sonoff S60 –∑ Tasmota –Ω–µ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ IP –∞–¥—Ä–µ—Å—É —Ç–∞ –º–µ—Ä–µ–∂–µ–≤–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
   ```bash
   ping 192.168.1.100
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Tasmota:
   ```bash
   curl http://192.168.1.100/cm?cmnd=Status
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ Tasmota –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –Ω–∞ Sonoff S60

4. –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ MQTT, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±—Ä–æ–∫–µ—Ä–æ–º

### –°–µ—Ä–≤—ñ—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
   ```bash
   sudo journalctl -u temperature.service -n 50
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —à–ª—è—Ö–∏ –≤ —Å–µ—Ä–≤—ñ—Å —Ñ–∞–π–ª—ñ
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É:
   ```bash
   ls -la ~/tapo
   ```

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –¥–∏–≤—ñ—Ç—å—Å—è:
- [README.md](README.md) - –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
- [PLAN.md](PLAN.md) - –¥–µ—Ç–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç—É

